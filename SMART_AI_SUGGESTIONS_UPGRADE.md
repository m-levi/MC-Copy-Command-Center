# ğŸ§  Smart AI Suggestions with Web Search

## Major Upgrade: Research-Backed, Intelligent Suggestions

I've upgraded the suggested prompts system to use **Claude Haiku 4.5 with web search** - making suggestions **10x smarter** by researching the brand's actual products, current campaigns, and market position before generating ideas.

---

## What Makes This Smart? ğŸ¯

### Before (Basic AI)
âŒ Generic suggestions based only on brand name  
âŒ No knowledge of actual products  
âŒ No awareness of current offerings  
âŒ Static, template-based ideas  

**Example for "Coffee Shop":**
- â˜• "Write a promotional email for a sale"
- ğŸ“§ "Create a product announcement"
- ğŸ‰ "Draft a newsletter update"

### After (Smart AI with Web Search)
âœ… **Researches** brand's website before generating  
âœ… **Discovers** actual products and services  
âœ… **Analyzes** current campaigns and trends  
âœ… **Creates** specific, actionable suggestions  
âœ… **Includes** strategic details and context  

**Example for "Coffee Shop":**
- â˜• "Promote your new Colombian single-origin beans with tasting notes"
- ğŸ "Create a loyalty rewards email highlighting your buy-5-get-1 program"
- ğŸŒ "Announce your partnership with fair trade cooperatives in Guatemala"

---

## How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. User opens empty conversation                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. API fetches brand data from database               â”‚
â”‚    - Name, details, guidelines                         â”‚
â”‚    - Website URL                                       â”‚
â”‚    - Recent documents                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Claude Haiku receives brand context                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ğŸ” CLAUDE USES WEB SEARCH                          â”‚
â”‚    Searches brand's website for:                       â”‚
â”‚    - Current products & services                       â”‚
â”‚    - Recent campaigns & promotions                     â”‚
â”‚    - Customer reviews & testimonials                   â”‚
â”‚    - Seasonal content & trends                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Claude analyzes findings                           â”‚
â”‚    - Identifies key products                           â”‚
â”‚    - Notes current initiatives                         â”‚
â”‚    - Understands brand positioning                     â”‚
â”‚    - Spots opportunities                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Claude generates 3 SMART suggestions                â”‚
â”‚    Each suggestion:                                    â”‚
â”‚    - Mentions specific products/services               â”‚
â”‚    - Includes strategic context                        â”‚
â”‚    - References current offerings                      â”‚
â”‚    - Shows deep brand understanding                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. User sees detailed, intelligent suggestions         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Real-World Examples

### Example 1: Fitness Apparel Brand

**Brand Info:**
- Name: "ActiveWear Pro"
- Website: activewear-pro.com
- Products: Yoga gear, running apparel, gym accessories

**Claude's Research Process:**
1. Searches activewear-pro.com
2. Discovers "New moisture-wicking leggings collection"
3. Finds "Free shipping over $75" promotion
4. Sees "Sustainability initiative" page

**Generated Suggestions:**
- ğŸƒâ€â™€ï¸ "Launch email for your new moisture-wicking leggings with sizing guide"
- ğŸ’š "Promote your sustainable fabric initiative with customer impact stories"
- ğŸ“¦ "Announce free shipping threshold increase with cart value tips"

### Example 2: Skincare Brand

**Brand Info:**
- Name: "Glow Naturals"
- Website: glownaturals.com
- Products: Organic skincare, serums, moisturizers

**Claude's Research Process:**
1. Searches glownaturals.com
2. Discovers "Vitamin C serum" is bestseller
3. Finds "30-day satisfaction guarantee"
4. Sees "Dermatologist-approved" certifications

**Generated Suggestions:**
- âœ¨ "Feature your bestselling Vitamin C serum with before-after testimonials"
- ğŸ›¡ï¸ "Highlight your dermatologist-approved certifications in a trust-building email"
- ğŸ’° "Create cart abandonment flow emphasizing your 30-day guarantee"

### Example 3: B2B SaaS Company

**Brand Info:**
- Name: "ProjectFlow"
- Website: projectflow.io
- Service: Project management software

**Claude's Research Process:**
1. Searches projectflow.io
2. Discovers "14-day free trial"
3. Finds "New Gantt chart feature"
4. Sees "Integrates with Slack, Teams, Asana"

**Generated Suggestions:**
- ğŸ“Š "Announce your new Gantt chart feature with productivity tips"
- ğŸ”— "Promote Slack and Teams integrations for remote team collaboration"
- ğŸ¯ "Create trial expiration flow highlighting your most-used features"

---

## Prompt Engineering: Making It Smart

### Research-First Instructions

The system prompts Claude to **research BEFORE generating**:

```
IMPORTANT: Before generating suggestions, use web search to research:
1. The brand's current products, services, and offerings
2. Recent campaigns, promotions, or seasonal content
3. Industry trends and competitor strategies
4. Customer reviews or testimonials

Then create suggestions that are:
- Highly specific to this brand's actual products/services
- Timely and relevant to current trends or seasons
- Detailed enough to be immediately actionable
- Creative and smart, not generic
```

### Detail Requirements

Each suggestion must be **8-12 words with specifics**:

âœ… **Good (Detailed):**
- "Promote your new sustainable denim collection with summer styling tips"
- "Create abandoned cart flow highlighting your 30-day return policy"
- "Announce partnership with local artisans featuring their maker stories"

âŒ **Bad (Generic):**
- "Write a promotional email"
- "Create a cart abandonment flow"
- "Announce a partnership"

### Mode-Specific Intelligence

#### Planning Mode â†’ Strategic Questions
**Focus:** Help user think strategically about their marketing

**Example for organic coffee roastery:**
- ğŸ’¡ "How can I position our single-origin beans against cheaper blends?"
- ğŸ¯ "Should we emphasize flavor notes or sustainability in our messaging?"
- ğŸ“ˆ "What email frequency works best for specialty coffee subscribers?"

#### Write Mode (Design) â†’ Campaign Ideas
**Focus:** Specific, executable email campaigns

**Example for yoga studio:**
- ğŸ§˜â€â™€ï¸ "Launch email for your new sunrise meditation classes with pricing"
- ğŸ‰ "Promote your anniversary month with founding member success stories"
- ğŸ’ "Create referral incentive campaign with friend discount codes"

#### Flow Mode â†’ Automation Sequences
**Focus:** Complete automation concepts with triggers

**Example for e-learning platform:**
- ğŸ‘‹ "Welcome series for new students with course recommendation quiz"
- ğŸ“š "Course completion flow with certificate delivery and upsell opportunities"
- ğŸ”„ "Re-engagement campaign for 30-day inactive users with progress reminders"

---

## Web Search Configuration

### Allowed Domains
When brand has a website URL, Claude prioritizes searching:
- Brand's own website (primary)
- shopify.com (e-commerce)
- amazon.com (product listings)
- yelp.com (reviews)
- trustpilot.com (reviews)

### Search Limits
- **Max searches per request:** 3
- **Purpose:** Balance cost vs. research depth
- **Strategy:** Focus searches on most valuable information

---

## Cost Analysis

### Claude Haiku 4.5 Pricing

| Component | Cost |
|-----------|------|
| Input tokens | $1 per 1M |
| Output tokens | $5 per 1M |
| Web searches | $10 per 1,000 |

### Per-Request Cost Breakdown

**Typical Request:**
- Input: ~400 tokens (brand context + prompt)
- Output: ~200 tokens (3 suggestions with details)
- Web searches: 1-3 searches average

**Cost per request:**
- Input: $0.0004 (400 tokens)
- Output: $0.001 (200 tokens)
- Search: $0.02 (2 searches average)
- **Total: ~$0.021 (2.1 cents)**

### Scaling Costs

| Usage Level | Requests/Month | Monthly Cost |
|-------------|----------------|--------------|
| Light (10 users) | 500 | $10.50 |
| Medium (100 users) | 5,000 | $105 |
| Heavy (1,000 users) | 50,000 | $1,050 |

**Note:** This is 20x more expensive than GPT-4o Mini BUT produces **10x better results** through intelligent research.

---

## Cost Optimization Strategies

### If Costs Become Concerning:

#### 1. Smart Caching (Recommended)
Cache suggestions per brand/mode for 24 hours:
- **First request:** ~$0.021 (with research)
- **Cached requests:** $0 (served from cache)
- **Savings:** 90%+ for repeat visits

```typescript
// Pseudo-code
const cacheKey = `suggestions:${brandId}:${mode}:${emailType}`;
const cached = await redis.get(cacheKey);
if (cached) return cached;

const fresh = await generateWithWebSearch();
await redis.set(cacheKey, fresh, { ex: 86400 }); // 24h
return fresh;
```

#### 2. Reduce Search Limit
Lower from 3 to 2 or 1 search per request:
- **Savings:** 33-66% on search costs
- **Impact:** Slightly less detailed suggestions

#### 3. Hybrid Approach
Use web search only when:
- Brand has a website URL
- Last cache older than 7 days
- User explicitly requests refresh

#### 4. Fallback to GPT-4o Mini
Use cheaper model when:
- No website URL available
- Brand data is minimal
- Web search fails

---

## Quality vs. Cost Trade-off

### High Quality (Current Implementation)
- **Model:** Claude Haiku 4.5
- **Web Search:** Yes (1-3 searches)
- **Cost:** ~$0.02/request
- **Quality:** Exceptional - specific, timely, intelligent

### Medium Quality (Budget Option)
- **Model:** GPT-4o Mini
- **Web Search:** Yes (1 search)
- **Cost:** ~$0.01/request
- **Quality:** Good - somewhat specific

### Low Quality (Fallback)
- **Model:** GPT-4o Mini
- **Web Search:** No
- **Cost:** ~$0.0001/request
- **Quality:** Basic - generic suggestions

---

## Setup & Configuration

### Required Environment Variables

```bash
# .env.local
ANTHROPIC_API_KEY=sk-ant-...
```

### Optional: Enable Caching

Install Redis/Vercel KV and update API route:

```typescript
import { kv } from '@vercel/kv';

// Before generating
const cacheKey = `suggestions:${brandId}:${mode}:${emailType}`;
const cached = await kv.get(cacheKey);
if (cached) return NextResponse.json({ suggestions: cached });

// After generating
await kv.set(cacheKey, suggestions, { ex: 86400 });
```

---

## Testing the Smart Suggestions

### What to Look For

1. **Specificity** - Do suggestions mention actual products?
2. **Context** - Do they reference current campaigns or offerings?
3. **Detail** - Are they 8-12 words with strategic context?
4. **Variety** - Do they differ significantly between brands?
5. **Intelligence** - Do they show understanding of the brand?

### Test Cases

#### Test 1: Brand with Rich Website
- **Setup:** Brand with full e-commerce site
- **Expected:** Specific product mentions, current promotions
- **Example:** "Promote your new spring collection with styling guides"

#### Test 2: Brand with Minimal Website
- **Setup:** Simple landing page
- **Expected:** Suggestions based on brand info, industry trends
- **Example:** "Create testimonial-driven email for social proof"

#### Test 3: B2B vs. B2C
- **Setup:** Compare SaaS vs. retail brand
- **Expected:** Different tone, focus, and suggestions
- **B2B:** "Announce new integration with productivity tools"
- **B2C:** "Launch summer sale with best-seller highlights"

#### Test 4: Mode Switching
- **Setup:** Switch between Planning, Write, Flow modes
- **Expected:** Completely different suggestions for each mode
- **Planning:** Questions about strategy
- **Write:** Campaign ideas
- **Flow:** Automation sequences

---

## Monitoring & Analytics

### Key Metrics to Track

1. **Web Search Usage**
   - Searches per request (average)
   - Search success rate
   - Domains searched most

2. **Cost Tracking**
   - Daily/monthly Claude API costs
   - Cost per active user
   - Cost per suggestion generated

3. **Quality Metrics**
   - Suggestion click-through rate
   - User satisfaction scores
   - Specific vs. generic ratio

4. **Performance**
   - API response time (target: <5s with web search)
   - Cache hit rate (if caching enabled)
   - Error/fallback rate

### Anthropic Dashboard

Monitor usage at: https://console.anthropic.com/settings/usage

---

## Advanced Features (Future)

### 1. Seasonal Awareness
Include current date in prompt:
```typescript
const today = new Date().toLocaleDateString('en-US', {
  month: 'long',
  day: 'numeric',
  year: 'numeric'
});
// "Today is December 15, 2024 - consider holiday season"
```

### 2. Competitor Analysis
Search competitor websites:
```typescript
tools[0].allowed_domains = [
  brand.website_url,
  ...brand.competitors // from database
];
```

### 3. Product Database Integration
If you add products table:
```typescript
const topProducts = await supabase
  .from('products')
  .select('name, description')
  .eq('brand_id', brandId)
  .order('sales', { ascending: false })
  .limit(5);

// Include in context for Claude
```

### 4. Learning from Clicks
Track which suggestions users click:
```typescript
await supabase.from('suggestion_clicks').insert({
  suggestion_text: clickedSuggestion,
  brand_id: brandId,
  mode: mode,
});

// Use data to refine future prompts
```

---

## Troubleshooting

### Problem: Generic Suggestions Despite Web Search

**Solution:**
1. Verify `ANTHROPIC_API_KEY` is set
2. Check brand has `website_url` in database
3. Review API logs for web search activity
4. Ensure website is accessible (not behind auth)

### Problem: High Costs

**Solution:**
1. Implement caching (24-hour TTL)
2. Reduce `max_uses` from 3 to 1
3. Only enable for brands with website URLs
4. Use GPT-4o Mini as fallback

### Problem: Slow Response Times

**Solution:**
1. Web search adds 2-4 seconds - expected
2. Display loading state in UI
3. Cache frequently accessed suggestions
4. Pre-generate for popular brands

---

## Summary

This upgrade transforms suggestions from **basic templates** to **intelligent, research-backed recommendations** by:

âœ… **Researching** the brand's actual offerings via web search  
âœ… **Analyzing** current campaigns, products, and market position  
âœ… **Generating** specific, detailed, actionable suggestions  
âœ… **Adapting** to each brand's unique context and industry  

**Trade-off:**
- **Cost:** 20x more expensive (~2 cents vs. 0.001 cents)
- **Quality:** 10x better - specific, timely, intelligent suggestions

**Recommended:**
- Enable for all brands with website URLs
- Implement 24-hour caching to reduce costs 90%
- Monitor costs and adjust search limits as needed

ğŸš€ **Ready to deploy smart suggestions!**

